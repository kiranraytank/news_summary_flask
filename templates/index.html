<!DOCTYPE html>
<html>
<head>
    <title>Raytik News Summary & Trend Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
        .matched {
            background-color: #ffd700;
            padding: 2px 5px;
            border-radius: 3px;
            margin-right: 3px;
        }
        .pagination {
            margin-top: 20px;
        }
        .pagination a {
            padding: 5px 10px;
            border: 1px solid #ccc;
            margin-right: 5px;
            text-decoration: none;
            color: #333;
        }
        .pagination a.current {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>
<h1>Raytik News Summary & Trend Tracker</h1>

<form method="post">
    <label>
        <input type="radio" name="mode" value="all" {% if mode=="all" %}checked{% endif %}> Simple News (all)
    </label>
    <label>
        <input type="radio" name="mode" value="keyword" {% if mode=="keyword" %}checked{% endif %}> Keyword-Specific News
    </label>

    <br><br>
    <select id="keywords" name="keywords" multiple="multiple" style="width:50%;" {% if mode!="keyword" %}disabled{% endif %}>
        <option value="sports" {% if 'sports' in selected_keywords %}selected{% endif %}>Sports</option>
        <option value="politics" {% if 'politics' in selected_keywords %}selected{% endif %}>Politics</option>
        <option value="technology" {% if 'technology' in selected_keywords %}selected{% endif %}>Technology</option>
        <option value="health" {% if 'health' in selected_keywords %}selected{% endif %}>Health</option>
        <option value="business" {% if 'business' in selected_keywords %}selected{% endif %}>Business</option>
        <option value="entertainment" {% if 'entertainment' in selected_keywords %}selected{% endif %}>Entertainment</option>
    </select>

    <br><br>
    <button type="submit">Search</button>
</form>

<hr>

{% if articles %}
    {% for article, summary, tags in zip(articles, summaries, tags_list) %}
        <div style="border:1px solid #ccc; padding:10px; margin:10px 0;">
            <h3><a href="{{ article.link }}" target="_blank">{{ article.title }}</a></h3>
            <p><strong>Summary:</strong> {{ summary | safe }}</p>

            <p><strong>Tags:</strong>
                {% for tag in article.tags %}
                    {% if tag.lower() in article.matched_keywords %}
                        <span class="matched">{{ tag }}</span>
                    {% else %}
                        {{ tag }}
                    {% endif %}
                {% endfor %}
            </p>

            {% if article.matched_keywords %}
                <p><strong>Matched Keywords:</strong>
                    {% for kw in article.matched_keywords %}
                        <span class="matched">{{ kw }}</span>
                    {% endfor %}
                </p>
            {% endif %}
        </div>
    {% endfor %}

    <!-- pagination -->
    {% if total_pages > 1 %}
        <div class="pagination">
            {% if page > 1 %}
                <a href="?page={{ page-1 }}&mode={{ mode }}{% for kw in selected_keywords %}&keywords={{ kw }}{% endfor %}">&laquo; Prev</a>
            {% endif %}

            {% set displayed_pages = [] %}
            {% if total_pages <= 5 %}
                {% set displayed_pages = range(1, total_pages + 1) %}
            {% else %}
                {% set displayed_pages = [1,2] %}
                {% if page > 3 and page < total_pages-2 %}
                    {% set displayed_pages = displayed_pages + [page-1, page, page+1] %}
                {% elif page >= total_pages-2 %}
                    {% set displayed_pages = displayed_pages + [total_pages-3, total_pages-2, total_pages-1] %}
                {% endif %}
                {% set displayed_pages = displayed_pages + [total_pages] %}
                {% set displayed_pages = displayed_pages | unique %}
            {% endif %}

            {% set last_page = 0 %}
            {% for p in displayed_pages %}
                {% if p - last_page > 1 %}
                    ...
                {% endif %}
                <a href="?page={{ p }}&mode={{ mode }}{% for kw in selected_keywords %}&keywords={{ kw }}{% endfor %}"
                {% if p == page %} class="current"{% endif %}>
                    {{ p }}
                </a>
                {% set last_page = p %}
            {% endfor %}

            {% if page < total_pages %}
                <a href="?page={{ page+1 }}&mode={{ mode }}{% for kw in selected_keywords %}&keywords={{ kw }}{% endfor %}">Next &raquo;</a>
            {% endif %}
        </div>
    {% endif %}



{% elif mode=="keyword" %}
    <p>No articles found for selected keywords: {{ selected_keywords | join(", ") }}</p>
{% else %}
    <p>No articles found.</p>
{% endif %}

<script>
$(document).ready(function() {
    $('#keywords').select2({
        placeholder: "Select keywords...",
        allowClear: true
    });

    $('input[name="mode"]').change(function(){
        if($(this).val() == 'keyword'){
            $('#keywords').prop('disabled', false);
        } else {
            $('#keywords').val(null).trigger('change');
            $('#keywords').prop('disabled', true);
        }
    });
});
</script>
</body>
</html>
